function setRequest(e,s){$.ajax({type:"POST",url:s,data:"text="+e+"&lang="+lang,success:function(e){e.search("#refresh#")>-1?location.reload():e.search("#reload#")>-1?enterPath(""):e.search("#imgs#")>-1?showGaleryEditor(e.substr(6)):e.search("#dirs#")>-1?(dirs=e.substr(6,e.search("#files#")-6),e=e.substr(e.search("#files#")+7),files=e,showBrowser()):"1"!=e&&alert(e)}})}function enterPath(e){if("../"==e){for(var s=browserPath,t=0;10>t;t++)s=s.replace("../","");""==s?browserPath+=e:(browserPath=browserPath.substr(0,browserPath.lastIndexOf("/")-1),browserPath=browserPath.substr(0,browserPath.lastIndexOf("/")+1))}else e=e.search("/")>-1?e:e+"/",e="/"==e?"":e,browserPath+=e;-1==browserPath.search(browserType)&&(browserPath=browserType+pageId+"/");var i=browserPath.substr(11);if(i=i.substr(0,i.search("/")),""!=e&&(document.getElementById("fileUpload1").src="fileUpload/index.php?id="+i),setRequest(browserPath,"getFiles.php",".out"),$(".browserPath").html(browserPath),1==browserMode){var r=browserPath.substr(browserPath.search("/")+1);if(r=r.substr(0,r.search("/")),r>0){var l=jsPageNames[r];l="undefined"==l?"deleted page":l,$(".browserPath").html(browserPath.replace(r,l))}}setCookie("filePath",browserPath,5)}function in_array(e,s){e=e.toLowerCase();for(var t=0;t<s.length;t++)if(e.search(s[t])>-1)return!0;return!1}function setBrowserType(){switch(document.browser.type.selectedIndex){case 1:browserType="web-others/";break;default:browserType="web-images/"}enterPath("")}function showBrowserSettings(){$(".browserSettingsOuter").toggleClass("hidden")}function setBrowserMode(e){if(browserMode=e.selectedIndex,setCookie("browserMode",browserMode,5),showBrowser(),$(".browserPath").html(browserPath),1==browserMode){var s=browserPath.substr(browserPath.search("/")+1);s=s.substr(0,s.search("/")),s>0&&$(".browserPath").html(browserPath.replace(s,jsPageNames[s]))}}function showBrowser(){hideMultipleOptions();for(var e='<div class="folderOuter"><div class="fileBrowserOptions"><img title="set view mode" src="images/gear.png" height="20" onclick="showBrowserSettings()" /></div><div class="folderInner" style="display:flex" onclick="enterPath(\'../\')" title="go up"><img height="15" src="images/folderUp.png" /> up</div>',s=";"==dirs?"":dirs;s.search(";")>-1;){var t=s.substr(0,s.search(";")),i="";t==pageId&&(i=" active"),0==browserMode?e+='<div class="folderInner'+i+'" onclick="enterPath(\''+s.substr(0,s.search(";"))+'\')" title="enter dir"><img height="15" src="images/folder.png" /> <nobr>'+t+"</nobr></div>":(t>0&&(t=jsPageNames[t]),e+='<div class="folderInner'+i+'" onclick="enterPath(\''+s.substr(0,s.search(";"))+'\')" title="enter dir"><img height="15" src="images/folder.png" /> <nobr>'+t+"</nobr></div>"),s=s.substr(s.search(";")+1)}e+="</div>";for(var r='<div class="fileOuter">',l=";"==files?"empty dir;":files,a=0;l.search(";")>-1;){var n=l.substr(0,l.search(";"));r+=in_array(n,imgTypes)?'<div class="fileInner"><div class="prevImg" id="prevImg'+a+'"><img onclick="showPicInfo(this,'+a+')" height="100" src="'+browserPath+n+'" /><div id="picInfo'+a++ +'" class="picInfo height0"></div></div></div>':"empty dir"!=n?'<div class="fileInnerFile">'+n+'<div class="fileOptions">&nbsp;<img src="images/plus.png" title="insert" onclick="insertBrowserFile(\''+n+'\')" height="18"/> <img src="images/pencil.png" title="rename" onclick="showPicRename(\''+n+'\')" height="18"/> <img src="images/bin.png" title="delete" onclick="showPicDelete(\''+n+'\')" height="18"/>&nbsp;</div></div>':"<div>"+n+"</div>",l=l.substr(l.search(";")+1)}r+="</div>",$(".leftFolders").html(e),$(".rightFiles").html(r)}function insertBrowserFile(e){$(".insertFile").removeClass("hidden"),$(".overlay").removeClass("hidden"),positionMessage(),$(".insertFileTitle").html(e),document.insertFile.name.value=e}function insertFileNow(){switch(document.insertFile.type.selectedIndex){case 1:insertHTMLatCursor('<iframe width="250" src="'+browserPath+document.insertFile.name.value+'"></iframe>');break;default:insertHTMLatCursor('<a target="_blank" href="'+browserPath+document.insertFile.name.value+'">'+document.insertFile.name.value+"</a>")}hideMessages()}function showPicInfo(e,s){if(""==$("#picInfo"+s).html()){var t=e.src.substr(e.src.lastIndexOf("/")+1),i=e.width<7*t.length?"<marquee>"+t+"</marquee>":t;$("#picInfo"+s).html('<div class="msgBoxImg"><img onclick="showPicInfo($(this).parent().parent().parent(),'+s+')" height="18" title="close" src="images/close.png"/></div><div class="picInfoTitle">'+i+'</div><div class="picHandler" onclick="showPicRename(\''+t+'\')">rename<img src="images/pencil.png" class="picHandlerImg"/></div><div class="picHandler" onclick="showPicDelete(\''+t+'\')">delete<img src="images/bin.png" class="picHandlerImg"/></div><div class="picHandler" onclick="showInsertPic(\''+browserPath+t+'\')">insert<img src="images/insert.png" class="picHandlerImg"/></div><div class="picHandler" onclick="showMovePics(\''+browserPath+t+'\')">move<img src="images/move.png" class="picHandlerImg"/></div>').removeClass("height0").width(e.width-2),$("#prevImg"+s).addClass("selected")}else $("#picInfo"+s).html("").addClass("height0"),$("#prevImg"+s).removeClass("selected");var r=$(".prevImg.selected").length;r>1?showMultipleOptions(r):hideMultipleOptions()}function showMultipleOptions(e){$(".multipleOptionsOuter").removeClass("hidden");var s='<div class="multipleOptionsItem" onclick="multipleDelete()">delete<img src="images/bin.png" class="picHandlerImg"/></div><div class="multipleOptionsItem" onclick="multipleInsert()">insert<img src="images/insert.png" class="picHandlerImg"/></div><div class="multipleOptionsItem" onclick="moveMultiplePics()">move<img src="images/move.png" class="picHandlerImg"/></div><div class="multipleOptionsItem" onclick="multipleDeselect()">deselect<img src="images/deselect.png" class="picHandlerImg"/></div><div class="multipleOptionsItem" onclick="multipleSelectAll()">select all<img src="images/select.png" class="picHandlerImg"/></div>';$(".multipleOptions").html("options for "+e+" elements:<br/>"+s)}function multipleSelectAll(){for(var e=$(".prevImg"),s=0;s<e.length;s++){var t=$(e[s]).attr("id"),i=document.getElementById(t);if("prevImg"==i.className){i.className="prevImg selected",i=i.children[0],t=t.substr(7);var r=i.src.substr(i.src.lastIndexOf("/")+1),l=i.width<7*r.length?"<marquee>"+r+"</marquee>":r;$("#picInfo"+t).removeClass("height0").html('<div class="msgBoxImg"><img onclick="showPicInfo($(this).parent().parent().parent(),'+t+')" height="18" title="close" src="images/close.png"/></div><div class="picInfoTitle">'+l+'</div><div class="picHandler" onclick="showPicRename(\''+r+'\')">rename</div><div class="picHandler" onclick="showPicDelete(\''+r+'\')">delete</div><div class="picHandler" onclick="showInsertPic(\''+browserPath+r+'\')">insert</div><div class="picHandler" onclick="showMovePics(\''+browserPath+r+"')\">move</div>").removeClass("height0").width(i.width-2)}}e.addClass("selected");var a=$(".prevImg.selected").length;a>1?showMultipleOptions(a):hideMultipleOptions()}function hideMultipleOptions(){$(".multipleOptionsOuter").addClass("hidden")}function showMovePics(e){e=replaceUml(e),positionMessage();for(var s=1,t=e;t.search(";")>0;)t=t.substr(t.search(";")+1),s++;$.ajax({type:"POST",url:"functions.php",data:'text=clickAbleMenu:movePicsNow("'+e+'",$pid):'+lang,success:function(e){$(".movePicMenu").html(e),$(".overlay").removeClass("hidden"),$(".movePicOuter").removeClass("hidden"),$(".movePicTitle").html(s)}})}function moveMultiplePics(){for(var e=$(".selected"),s="",t=0;t<e.length;t++){var i=$("#"+$(e[t]).attr("id")+" img").attr("src");i&&(s+=i+";")}s=s.substr(0,s.length-1),showMovePics(s)}function movePicsNow(e,s){e=replaceUml(e),$.ajax({type:"POST",url:"functions.php",data:"text=movePics:"+e+":"+s,success:function(e){""==e?(hideMessages(),showNotification("Pics moved",1e3),hideMultipleOptions(),enterPath("")):alert(e)}})}function multipleDeselect(){for(var e=$(".fileInner").find($(".selected")),s=0;s<e.length;s++)$("#"+$(e[s]).attr("id")).removeClass("selected"),$("#"+$(e[s]).attr("id").replace("prevImg","picInfo")).addClass("height0").html("");hideMultipleOptions()}function multipleDelete(){var e,s=$(".selected"),t=[],i=0;for(e=0;e<s.length;e++){var r=$("#"+$(s[e]).attr("id")+" img").attr("src");r&&(t[i++]=replaceUml(r))}adminPicsToDelete=t,$(".deletePicMultipleTitle").html("delete "+i+" pictures?"),$(".overlay").removeClass("hidden"),$(".deleteMultiplePic").removeClass("hidden"),positionMessage()}function deleteMultiplePicNow(e){$.ajax({type:"POST",url:"deletePic.php",data:"path="+adminPicsToDelete[e],success:function(s){"1"!=s&&alert(s),e<adminPicsToDelete.length-1?deleteMultiplePicNow(e+1):(enterPath(""),hideMessages())}})}function multipleInsert(){for(var e=$(".selected"),s="",t=0;t<e.length;t++){var i=$("#"+$(e[t]).attr("id")+" img").attr("src");i&&(s+='<img class="galPic" height="100" src="'+i+'"/>')}$(".overlay").removeClass("hidden"),$(".htmlToInsertMulti").html('<div class="pictureFrame">'+s+"</div>"),positionMessage(),$(".insertMultiplePic").removeClass("hidden")}function multipleInsertNow(){insertHTMLatCursor($(".htmlToInsertMulti").html()),hideMessages(),togglePicsClickable(),togglePicsClickable()}function showPicRename(e){document.rename.old.value=e,document.rename.name.value=e.substr(0,e.lastIndexOf(".")),document.rename.ending.value=e.substr(e.lastIndexOf(".")),positionMessage(),$(".renamePic").removeClass("hidden"),$(".overlay").removeClass("hidden")}function renamePicNow(){setRequest("rename:"+replaceUml(document.rename.old.value)+":"+replaceUml(document.rename.name.value)+document.rename.ending.value+":"+browserPath,"functions.php",".out"),hideMessages()}function showPicDelete(e){document["delete"].name.value=e,$(".deletePicTitle").html("delete file "+e+"?"),positionMessage(),$(".deletePic").removeClass("hidden"),$(".overlay").removeClass("hidden")}function deletePicNow(){setRequest("delete:"+replaceUml(document["delete"].name.value)+":"+browserPath,"functions.php",".out"),hideMessages()}function showInsertPic(e){document.insert.path.value=e,document.insert.type.selectedIndex=0,document.insert.align.selectedIndex=0,changeInsertType(),positionMessage(),$(".insertPic").removeClass("hidden"),$(".overlay").removeClass("hidden")}function changeInsertType(){var e="",s="pagePic",t="";switch(document.insert.align.selectedIndex){case 0:t="";break;case 1:t="left";break;case 2:t="right";break;case 3:t="center;width:100%"}switch(document.insert.type.selectedIndex){case 0:e=""!=t?'<img width="250" style="float:'+t+'" src="'+document.insert.path.value+'" />':'<img width="250" src="'+document.insert.path.value+'" />';break;case 1:e=""!=t?'<div style="float:'+t+'" class="titledImg '+s+'"><div class="imgTitle">Title</div><img width="250" src="'+document.insert.path.value+'" /></div>':'<div class="titledImg '+s+'"><div class="imgTitle">Title</div><img width="250" src="'+document.insert.path.value+'" /></div>';break;case 2:e=""!=t?'<div style="float:'+t+'" class="titledImg '+s+'"><img width="250" src="'+document.insert.path.value+'" /><div class="imgTitle">Title</div></div>':'<div class="titledImg '+s+'"><img width="250" src="'+document.insert.path.value+'" /><div class="imgTitle">Title</div></div>'}$(".htmlToInsert").html('<table><tr><td id="htmlToInsert">'+e+"</td></tr></table>")}function insertPicNow(){insertHTMLatCursor($("#htmlToInsert").html()+"<p>&nbsp;</p>"),hideMessages(),togglePicsClickable(),togglePicsClickable()}function showGaleryMaker(){"thumbs/"!=browserPath.substr(-7)&&enterPath("thumbs/"),setRequest(browserPath+"&gal=1","getFiles.php",".out")}function showGaleryEditor(e){hideMessages();for(var s="",t=";"==e?"empty dir;":e,i=0,r=$(".gallery").find("img").map(function(){return this}).get(),l=[],a=0;a<r.length;a++){var n=r[a].src.replace(location.toString(),"");n=n.substr(n.lastIndexOf("web-images/")),l.push(n)}for(r=null;t.search(";")>-1;){var c=t.substr(0,t.search(";"));if(in_array(c,imgTypes)){var o=findInArray(l,browserPath+c)>-1?" selected":"";s+='<div class="galMakerImg'+o+'" id="galMakerImg'+i+'"><img id="galImg'+i+'" onclick="toggleGalPicSel('+i++ +')" height="100" src="'+browserPath+c+'" /></div>'}t=t.substr(t.search(";")+1)}$(".galeryMakerInner").html(s),$(".overlay").removeClass("hidden"),$(".galeryMakerOuter").css("right",0).css("width",windowWidth/2),"thumbs/"==browserPath.substr(-7)&&enterPath("../")}function hideGaleryEditor(){$(".galeryMakerInner").html(""),$(".galeryMakerOuter").css("right",-windowWidth/2)}function galeryMakerSelectAll(e){var s=!0,t=0;try{for(;s;)document.getElementById("galMakerImg"+t).className.search("galMakerImg")>-1?document.getElementById("galMakerImg"+t).className=e?"galMakerImg selected":"galMakerImg":s=!1,t++}catch(i){}}function toggleGalPicSel(e){document.getElementById("galMakerImg"+e).className="galMakerImg"!=document.getElementById("galMakerImg"+e).className?"galMakerImg":"galMakerImg selected"}function generateGallery(){var e=!0,s=0,t=getCurrentHTML(),i="";!t.search('<div class="picsClickAble">')>-1&&togglePicsClickable();try{for(;e;){if(document.getElementById("galMakerImg"+s).className.search("selected")>-1){var r=document.getElementById("galImg"+s).src;r=r.substr(r.lastIndexOf("web-images/")),i+='<img class="galImg" height="100" src="'+r+'" />'}s++}}catch(l){}t.search('class="gallery')>-1?$(".gallery").html(i):insertHTMLatTheEnd('<div class="gallery">'+i+"</div>"),hideMessages()}var dirs,files,browserPath="",imgTypes=[".jpg",".png",".gif",".svg"],browserType="web-images/",browserMode=0,adminPicsToDelete=[];