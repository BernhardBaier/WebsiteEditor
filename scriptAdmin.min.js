function reloadLocation(e){window.location.href=document.location.toString().substr(0,document.location.toString().lastIndexOf("/"))+"/admin.php?id="+pageId+"&action="+e}function confirmExit(){return startHTML!=replaceUml(getCurrentHTML())&&'<p>page not existent jet.<br /><span style="color<dpp>#555;font-size<dpp>12px;">Tipp<dpp> press crtl+s to save changes.</span></p>'!=replaceUml(getCurrentHTML())&&mayCancelLogOut?"Save Content!":(document.getElementsByClassName("pageLoading")[0].className="pageLoading",void(document.getElementsByClassName("loadingMessage")[0].innerHTML="Loading"))}function getCharacterOffsetWithin(e,t){for(var s=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,function(t){var s=document.createRange();return s.selectNodeContents(t),s.compareBoundaryPoints(Range.END_TO_END,e)<1?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},!1),a=0;s.nextNode();)a+=s.currentNode.length;return 3==e.startContainer.nodeType&&(a+=e.startOffset),a}function getCKEPosition(){try{var e=document.getElementById("editable"),t=window.getSelection().getRangeAt(0);actCKEPos=getCharacterOffsetWithin(t,e)}catch(s){actCKEPos="NULL"}}function getCurrentHTML(){return CKEDITOR.instances.editable.getData()}function setEditorHTML(e){CKEDITOR.instances.editable.setData(e)}function insertHTMLatCursor(e){try{CKEDITOR.instances.editable.insertHtml(e)}catch(t){insertHTMLatTheEnd(e)}}function insertHTMLatTheEnd(e){try{var t=getCurrentHTML(),s=t.search('<div class="picsClickAble">');if(s>-1){var a=t.substr(0,t.lastIndexOf("</div>"));t=a+e+t.substr(t.lastIndexOf("</div>"))}else t+=e;setEditorHTML(t)}catch(n){alert("unable to insert!")}}function init(){getSize(),printMenu(),document.getElementById("editable").addEventListener("mouseup",function(){getCKEPosition()},!1),$(".content").keyup(function(){getCKEPosition()}),browserMode=getCookie("browserMode"),"NULL"==browserMode&&(browserMode=0),document.getElementById("browserViewModeChooser").selectedIndex=browserMode;var e=getCookie("filePath");e.search("web-documents/")>-1?(document.browser.type.selectedIndex=1,setBrowserType()):pageId>0&&enterPath("web-images/"+pageId+"/"),"1"==getCookie("leftBarPos")?(setCookie("leftBarPos","0",5),toggleLeftBar()):(setCookie("leftBarPos","0",5),sizeMenu()),"0"==getCookie("fileBrowserPos")&&toggleFileBrowser(),showPageTour&&$(".pageTour").removeClass("hidden"),hideGaleryEditor(),$(".pageMenuTitle").html(jsPageNames[pageId]),$(".pageName").html(jsPageNames[pageId]),$("#menuItemInner"+pageId).addClass("active"),$(".loadingMessage").html("Init"),1==showPlugIn?showPlugins():1==showUsers&&$(".ownUserControlOuter").removeClass("hidden"),window.setTimeout("postInit()",250),window.onbeforeunload=confirmExit,document.getElementsByClassName("pageContainer")[0].style.width="calc(100% - 22px)",document.getElementsByClassName("pageContainer")[0].style.left="24px",window.setTimeout("$('.pageLoading').addClass('hidden')",350)}function postInit(){setBrowserType(),initOptions(),$("body").keypress(function(e){return 27==e.keyCode?(closeEverything(),e.preventDefault(),!1):e.ctrlKey||19==e.which?115==e.which?(saveText("content",!1),e.preventDefault(),!1):112==e.which?(saveText("content",!0),e.preventDefault(),!1):97==e.which?(multipleSelectAll(),e.preventDefault(),!1):!0:!0}),"function"==typeof initUserOptions&&initUserOptions(),window.setTimeout("setStartHTML()",1e3),$(".pageLoading").addClass("opac0"),document.body.overflow="visible",$(".fileBrowser").css("transition","bottom 1s").css("-webkit-transition","bottom 1s"),$(".leftBar").css("transition","left 1s").css("-webkit-transition","left 1s"),$(".content").css("transition","height 1s").css("-webkit-transition","height 1s"),$(".pageMenu").css("transition","height 1s").css("-webkit-transition","height 1s"),$(".pageContainer").css("transition","width 1s,left 1s").css("-webkit-transition","width 1s,left 1s"),$(".pageTour").removeClass("opac0"),window.setInterval("checkIfUserIsLoggedIn()",6e4)}function closeEverything(){hideMessages(),$(".pluginOuter").addClass("out"),$(".userControlOuter").addClass("out"),$(".fileUpload").addClass("hidden"),hideGaleryEditor(),multipleDeselect()}function setStartHTML(){startHTML=replaceUml(CKEDITOR.instances.editable.getData())}function checkIfUserIsLoggedIn(){$.ajax({type:"POST",url:"functions.php",data:"text=getLoggedIn",success:function(e){"1"!=e&&(alert(e),mayCancelLogOut=!1)}})}function initPageTour(){showPageTour=!0}function showPageTourFunc(){$(".pageOptions").addClass("hidden").addClass("height0"),$(".pageTour").removeClass("hidden"),$(".pageMenuItem").removeClass("active"),pageTourStep(0)}function sizeMenu(){var e=$(".leftBar").width();"1"==getCookie("leftBarPos")?(document.getElementsByClassName("pageContainer")[0].style.width="calc(100% - 22px)",document.getElementsByClassName("pageContainer")[0].style.left="24px",$(".leftBar").css("left",-e-15)):(document.getElementsByClassName("pageContainer")[0].style.width="calc(100% - "+(e-3)+"px)",document.getElementsByClassName("pageContainer")[0].style.left=e-7+"px"),showPageTour&&pageTourStep(0)}function addMainPage(e){e=""==e?document.input.pageName.value:e,menuChange("addMainPage:"+replaceUml(e))}function showRename(e,t){document.input2.pagename.value=t,document.input2.id.value=e,$(".rename").removeClass("hidden"),$(".overlay").removeClass("hidden"),positionMessage()}function renameNow(){document.input2.pagename.value&&(menuChange("changeName:"+document.input2.id.value+":"+replaceUml(document.input2.pagename.value)),hideMessages())}function showDelete(e,t){document.input3.id.value=e,$(".deleteTitle").html("Delete Page "+t+"?"),$(".delete").removeClass("hidden"),$(".overlay").removeClass("hidden"),positionMessage()}function deleteNow(){menuChange("deletePage:"+document.input3.id.value),hideMessages()}function setVisibility(e,t){menuChange("setVisibility:"+e+":"+t)}function showAddSubPage(e,t){document.input4.parent.value=e,$(".addSubPageTitle").html("Add sub page to "+t+":"),$(".addSubPage").removeClass("hidden"),$(".overlay").removeClass("hidden"),positionMessage()}function addSubPage(){document.input4.pagename.value&&(menuChange("addSubPage:"+replaceUml(document.input4.pagename.value)+":"+document.input4.parent.value),hideMessages())}function showAddEqualPage(e,t,s){document.input5.parent.value=e,document.input5.rank.value=t,$(".addEqualPageTitle").html("Add equal page to "+s+":"),$(".addEqualPage").removeClass("hidden"),$(".overlay").removeClass("hidden"),positionMessage()}function addEqualPage(){document.input5.pagename.value&&(menuChange("addEqualPage:"+replaceUml(document.input5.pagename.value)+":"+document.input5.parent.value+":"+document.input5.rank.value),hideMessages())}function positionMessage(){$(".msgBox").css("top",window.pageYOffset+windowHeight/5).css("left",windowWidth/2-90),$(".overlay").css("top",window.pageYOffset)}function positionMessageTop(){$(".notificationBox").css("top",window.pageYOffset+15).css("right",150).css("left",$(".leftBar").width()+20)}function hideMessages(){$(".msgBox").addClass("hidden"),$(".overlay").addClass("hidden"),$(".insertLinkOuter").addClass("hidden"),hideGaleryEditor()}function hideGroupe(e){$("#menGrpIn"+e).removeClass("hidden"),$("#menGrpCt"+e).addClass("hidden");var t=getCookie("pagesHidden");"NULL"!=t?(t=JSON.parse(t),-1==findInArray(t,e)&&(t[t.length]=e)):t=[e],sizeMenu(),setCookie("pagesHidden",JSON.stringify(t),5)}function showGroupe(e){$("#menGrpCt"+e).removeClass("hidden"),$("#menGrpIn"+e).addClass("hidden");var t=getCookie("pagesHidden");if("NULL"!=t){t=JSON.parse(t);var s=findInArray(t,e);s>-1&&t.splice(s,1),setCookie("pagesHidden",JSON.stringify(t),5)}sizeMenu()}function showOptions(e,t,s,a){document.getElementById("menuOptions"+e).className.search("hidden")>-1?($("#menuOptions"+e).html('<div class="menuOptionsItem"><a title="rename page '+t+'" href="javascript:showRename('+e+",'"+t+'\')">rename<img src="images/pencil.png" class="menuOptionImg"/></a></div><div class="menuOptionsItem"><a title="delete page '+t+'" href="javascript:showDelete('+e+",'"+t+'\')">delete<img src="images/bin.png" class="menuOptionImg"/></a></div><div class="menuOptionsItem"><a title="add a sub page to '+t+'" href="javascript:showAddSubPage('+e+",'"+t+"')\">add sub page</a></div>").removeClass("hidden"),s>0&&(document.getElementById("menuOptions"+e).innerHTML+='<div class="menuOptionsItem"><a title="add a page after '+t+'" href="javascript:showAddEqualPage('+s+","+(a+1)+",'"+t+"')\">add page</a></div>"),document.getElementById("menuOptionsImg"+e).src="images/calendarHide.png"):($("#menuOptions"+e).addClass("hidden"),document.getElementById("menuOptionsImg"+e).src="images/calendarShow.png")}function handleDragStart(e){"menuItemInner"==e.target.className?$(e.target).addClass("dragElement"):$(e.target).parent().addClass("dragElement"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",e.target.id.replace("menuItem",""))}function handleDragOver(e){preventDropDefault(e),e.dataTransfer.dropEffect="move";var t=e.target.id.replace("menuItem","");t.search("_")>-1&&(t=t.substr(0,t.length-2));var s=e.dataTransfer.getData("text/html");return t%2!=0&&($(".menuItem").removeClass("visib"),t!=s&&(document.getElementById("menuItem"+(parseInt(t)-1)).classList.add("visib"),document.getElementById("menuItem"+(parseInt(t)+1)).classList.add("visib"))),!1}function preventDropDefault(e){e.preventDefault&&e.preventDefault()}function handleDragEnter(e){("menuItemInner"==e.target.className||""==e.target.className)&&$(".menuItemInner").removeClass("over"),$(".menuItem").removeClass("over"),$(".menuItemLeftDrop").removeClass("over"),$(".menuItemRightDrop").removeClass("over"),e.target.classList.add("over")}function handleDragEnd(e){$(".menuItemInner").css("opacity","1"),$(".menuItem").removeClass("visib"),$(".menuItem").removeClass("over"),$(".menuItemInner").removeClass("over"),$(".menuItemLeftDrop").removeClass("over"),$(".menuItemRightDrop").removeClass("over"),e.target.classList.remove("over")}function handleDrop(e){preventDropDefault(e);var t=e.target.id.replace("menuItem",""),s=t.search("_")>-1?t.substr(0,t.search("_")):t;s%4==0?s++:s--;var a=document.getElementById("menuItemInfo"+e.dataTransfer.getData("text/html").replace("menuItem","")).innerHTML,n=a.substr(0,a.search(";"));a=a.substr(a.search(";")+1);var o=a.substr(0,a.search(";"));a=a.substr(a.search(";")+1);var i=a.substr(0,a.search(";"));a=a.substr(a.search(";")+1);a.substr(0,a.search(";"));a=document.getElementById("menuItemInfo"+s).innerHTML;var r=a.substr(0,a.search(";"));a=a.substr(a.search(";")+1);var d=a.substr(0,a.search(";"));a=a.substr(a.search(";")+1);var l=a.substr(0,a.search(";"));a=a.substr(a.search(";")+1);a.substr(0,a.search(";"));return t.search("_")>-1?"1"==t.substr(t.search("_")+1)?menuChange(o==d?l>i?"moveRank:"+n+":"+l:"moveRank:"+n+":"+(parseInt(l)+1):"movePageAndRank:"+n+":"+d+":"+(parseInt(l)+1)):n!=d&&menuChange("movePageAndRank:"+n+":"+r+":1"):menuChange(o==d&&r!=n?l>i?"moveRank:"+n+":"+(parseInt(l)-1):"moveRank:"+n+":"+l:"movePageAndRank:"+n+":"+d+":"+l),!1}function drag(e,t,s,a,n){e.dataTransfer.setData("Id",t),e.dataTransfer.setData("Parent",s),$(".infoBox").removeClass("hidden"),$(".infoBoxTitle").html("insert "+n)}function drop(e,t,s,a,n){e.preventDefault();var o=e.dataTransfer.getData("Id"),i=e.dataTransfer.getData("Parent");if(o!=t)switch(n){case 0:s==i&&o!=s?menuChange("moveRank:"+o+":"+a):o!=s&&menuChange("movePageAndRank:"+o+":"+s+":"+a);break;case 1:menuChange(s==i?"moveRank:"+o+":"+a:"movePageAndRank:"+o+":"+s+":"+(a+1));break;case 2:t!=i&&menuChange("movePageAndRank:"+o+":"+t+":1");break;default:$(".dragBarBottom").css("height",0).css("top",dropBotOff+25),$(".dragBarTop").css("height",0).css("top",dropTopOff+25)}else $(".dragBarBottom").css("height",0).css("top",dropBotOff+25),$(".dragBarTop").css("height",0).css("top",dropTopOff+25);hideMessages()}function dragOver(e,t,s){switch(e.preventDefault(),t){case 1:$(".infoBoxInfo").html("before "+s);break;case 2:$(".infoBoxInfo").html("after "+s);break;case 3:$(".infoBoxInfo").html("as a child of "+s);break;default:t=t.substr(1),t!=e.dataTransfer.getData("Id")&&($(".dragBarBottom").css("height",0).css("top",dropBotOff+25),$(".dragBarTop").css("height",0).css("top",dropTopOff+25),$("#dragBarBottom"+t).css("height",25).css("top",dropBotOff),$("#dragBarTop"+t).css("height",25).css("top",dropTopOff))}}function dragOut(e){e.preventDefault(),$(".dragBarBottom").css("height",0).css("top",dropBotOff+25),$(".dragBarTop").css("height",0).css("top",dropTopOff+25)}function replaceUml(e){for(var t=[["ä","ö","ü","Ä","Ö","Ü","ß","&",":"],["<und>auml;","<und>ouml;","<und>uuml;","<und>Auml;","<und>Ouml;","<und>Uuml;","<und>szlig;","<und>","<dpp>"]],s=0;s<t[0].length;s++)for(;e.search(t[0][s])>-1;)e=e.replace(t[0][s],t[1][s]);return e}function menuChange(e){$.ajax({type:"POST",url:"MySQLHandler.php",data:"table=pages_"+lang+"&function="+e,success:function(e){1!=e&&""!=e?$(".menu").html(e):window.setTimeout("printMenu()",1)}})}function reprintMenu(){"&nbsp;&nbsp;&nbsp;&nbsp;reprint menu"==$(".menu").html()&&printMenu()}function printMenu(){$.ajax({type:"POST",url:"MySQLHandler.php",data:"table=pages_"+lang+"&function=printMenu",success:function(e){pageIsIniting&&(pageIsIniting=!1,window.setTimeout("sizeMenu()",200)),("1"==e||""==e)&&(e='database created</br><img src="images/plus.png" height="15" /> add pages.'),$(".menu").html(e+'<div class="menuSub"><form name="input" action="javascript:addMainPage(\'\')"><input name="pageName" required placeholder="create main page" type="text" /><input type="submit" value="create"/></form></div>');var t=getCookie("pagesHidden");if("NULL"!=t){t=JSON.parse(t);for(var s=0;s<t.length;s++)hideGroupe(t[s])}sizeMenu(),$("#menGrpIn"+pageId).children().find(".menuItemHidden").first().addClass("menuGroupActive").prop("title","active page"),$("#menGrpCt"+pageId).children().find(".menuItemInner").first().addClass("menuGroupActive").prop("title","active page")}})}function getNameById(e,t){$.ajax({type:"POST",url:"MySQLHandler.php",data:"table=pages_"+lang+"&function=getNameById:"+e,success:function(e){$(t).html(e)}})}function findInArray(e,t){for(var s=0;s<e.length;s++)if(e[s]==t)return s;return-1}function setCookie(e,t,s){var a=new Date;a.setDate(a.getDate()+s);var n=escape(t)+(null==s?"":"; expires="+a.toUTCString());document.cookie=e+"="+n}function getCookie(e){var t=document.cookie,s=t.indexOf(" "+e+"=");if(-1==s&&(s=t.indexOf(e+"=")),-1==s)t="NULL";else{s=t.indexOf("=",s)+1;var a=t.indexOf(";",s);-1==a&&(a=t.length),t=unescape(t.substring(s,a))}return t}function toggleLeftBar(){if("0"==getCookie("leftBarPos"))$(".leftBar").css("left",-($(".leftBar").width()+15)),document.getElementsByClassName("pageContainer")[0].style.width="calc(100% - 22px)",document.getElementsByClassName("pageContainer")[0].style.left="24px",setCookie("leftBarPos","1",5);else{var e=$(".leftBar").width();document.getElementsByClassName("pageContainer")[0].style.width="calc(100% - "+(e-3)+"px)",document.getElementsByClassName("pageContainer")[0].style.left=e-7+"px",$(".leftBar").css("left",0),setCookie("leftBarPos","0",5)}$(".leftBarNav").toggleClass("imgRotated")}function toggleFileBrowser(){70==$(".pageMenu").height()?(document.getElementsByClassName("content")[0].style.height="calc(100% - 343px)",$(".pageMenu").css("height",33),document.getElementsByClassName("fileBrowser")[0].style.bottom="0px",setCookie("fileBrowserPos","1",5)):(document.getElementsByClassName("content")[0].style.height="calc(100% - 102px)",$(".pageMenu").css("height",70),$(".fileHider").html('<img src="images/fileUp.png" height="20" onclick="showFileBrowser()" title="show file Browser" />&nbsp;'),document.getElementsByClassName("fileBrowser")[0].style.bottom="-277px",setCookie("fileBrowserPos","0",5)),$(".fileHider").toggleClass("imgRotated")}function showUpload(){$(".fileUpload").toggleClass("hidden"),enterPath(""),restoreUpload()}function restoreUpload(){"fileUpload background"==document.getElementsByClassName("fileUpload")[0].className&&(document.getElementsByClassName("fileUpload")[0].className="fileUpload"),document.getElementById("fileUpload1").style.opacity=1,document.getElementById("loadingImg2").className="waitIcon hidden",document.getElementsByClassName("fileUploadOnBackground")[0].className="fileUploadOnBackground hidden",document.getElementsByClassName("fileUploadBackground")[0].innerHTML="Background";try{window.clearInterval(refreshFilesOnBackground)}catch(e){}}function toggleUploadBackground(){"fileUpload"==document.getElementsByClassName("fileUpload")[0].className?(document.getElementsByClassName("fileUpload")[0].className="fileUpload background",document.getElementsByClassName("fileUploadOnBackground")[0].className="fileUploadOnBackground",document.getElementsByClassName("fileUploadBackground")[0].innerHTML="Foreground",document.getElementById("fileUpload1").style.opacity=0,document.getElementById("loadingImg2").className="waitIcon",refreshFilesOnBackground=window.setInterval("enterPath('')",5e3)):restoreUpload()}function showUploadError(){$(".overlay").removeClass("hidden"),$(".uploadError").removeClass("hidden")}function saveText(e,t){var s=document.getElementsByClassName("titledImg"),a=$("#editable").width(),n=!1;if(s)for(var o=0;o<s.length;o++){var i=s[o].style.width.search("px");i>-1&&(i=s[o].style.width.substr(0,i),i=Math.round(i/a*1e3)/10,s[o].style.width=i+"%",n=!0);var r=s[o].innerHTML.match(/<img[\w\W]+?width:[\s0-9]+?px[\w\W]+?>/gi);if(null!=r){r=r.toString(),i=r.substr(r.search("width:")+6),i=i.substr(0,i.search("px")).replace(" ","");var d=Math.round((parseInt(i)+8)/a*1e3)/10;s[o].innerHTML=s[o].innerHTML.replace(r.toString(),r.replace(i+"px","100%")).replace(/height:[\s0-9]+?px/,"").replace(/height="[0-9]+?"/,""),s[o].style.width=d+"%",n=!0}}var l=getCurrentHTML(),c=l.match(/<img[\w\W]+?>/gi),u=[];if(null!=c)for(var h=0;h<c.length;h++){var p=c[h].match(/<img[\w\W]+?width:[\s0-9]+?px[\w\W]+?>/gi);null==p&&(p=c[h].match(/<img[\w\W]+?width="[\s0-9]+?"[\w\W]+?>/gi)),null!=p&&(u[u.length]=p.toString())}if(null!=u)for(h=0;h<u.length;h++){u[h]=u[h].toString(),i=u[h].substr(u[h].search("width")+6);var g=i.search("px"),m=i.search('"');g=0>g?1e6:g,m=0>m?1e6:m;var f="px",v=0;g>m?(i=i.substr(1),v=i.search('"'),f=""):v=g,i=i.substr(0,v).replace(" ",""),d=Math.round(parseInt(i)/a*1e3)/10;var w=u[h].replace(i+f,d+"%").replace(/height:[\s0-9]+?px/,"").replace(/height="[0-9]+?"/,"");l=l.replace(u[h],w),n=!0}l!=getCurrentHTML()&&setEditorHTML(l),l=replaceUml(l),$.ajax({type:"POST",url:"functions.php",data:"text=storeText:"+l+":"+e+"/"+lang+"/"+pageId+".php&lang="+lang+"&id="+pageId,success:function(e){e.search("#saved#")>-1&&e.search("#preview#")>-1?(startHTML=replaceUml(getCurrentHTML()),t?publishPageNow():hideMessages(),n?showNotification("The sizes have been changed to equal relative sizes and the changes have been saved",3500):showNotification("The changes have been saved",1500)):"1"!=e&&alert(e)}})}function publishPageNow(){$.ajax({type:"POST",url:"MySQLHandler.php",data:"table=pages_"+lang+"&function=getValueById:"+pageId+":extra",success:function(e){"1"==e?$.ajax(document.getElementById("publishPageLang").checked?{type:"POST",url:"functions.php",data:"text=publishText&lang=all&langs="+jsLanguages+"&id="+pageId,success:function(e){-1!=e.search("#published#")?(hideMessages(),startHTML=replaceUml(getCurrentHTML()),showNotification("All languages have been published",1500)):"1"!=e&&alert(e)}}:{type:"POST",url:"functions.php",data:"text=publishText&lang="+lang+"&id="+pageId,success:function(e){-1!=e.search("#published#")?(hideMessages(),showNotification("Page has been published",1500)):"1"!=e&&alert(e)}}):(hideMessages(),$(".publishErrorOuter").removeClass("opac0 hidden"),$(".overlay").removeClass("opac0 hidden"))}})}function publishPageWithVisib(){$.ajax({type:"POST",url:"MySQLHandler.php",data:"table=pages_"+lang+"&function=setVisibility:"+pageId+":1",success:function(e){"1"==e?(hideMessages(),document.getElementById("visibImg"+pageId).innerHTML="<img src='images/eye.png' height='18' title='visible' onclick='setVisibility("+pageId+",0)' />",publishPageNow()):(alert(e),hideMessages())}})}function showNotification(e,t){positionMessageTop(),$(".notificationBox").removeClass("hidden").removeClass("opac0"),$(".notificationBoxInner").html(e),notificationBoxMayHide=!0,window.setTimeout("hideNotificationBox()",t)}function notificationBoxHover(){notificationBoxMayHide=!1,$(".notificationBox").removeClass("opac0")}function notificationBoxDisHover(){notificationBoxMayHide=!0,hideNotificationBox()}function hideNotificationBox(){notificationBoxMayHide&&($(".notificationBox").addClass("opac0"),window.setTimeout("hideNotificationBoxCompletely()",450))}function hideNotificationBoxCompletely(){notificationBoxMayHide?$(".notificationBox").addClass("hidden"):$(".notificationBox").removeClass("opac0")}function showPageOptions(e,t){$(".pageOptions").toggleClass("height0").toggleClass("hidden"),$(t).toggleClass("active")}function togglePicsClickable(e){e||(e=document.getElementById("pageOptionItemPics"));for(var t=getCurrentHTML(),s=!1;t.search('<div class="picsClickAble">')>-1;){var a=t,n=$(".picsClickAble").html(),o=a.replace(n,"");a=o.substr(o.search('<div class="picsClickAble">')+27),a=a.substr(a.search("</div>")+6),o=o.substr(0,o.search('<div class="picsClickAble">')),setEditorHTML(o+n+a),s=!0,t=getCurrentHTML()}s?$(e).removeClass("selected"):(setEditorHTML('<div class="picsClickAble">'+t+"</div>"),$(e).addClass("selected"))}function initOptions(){-1==getCurrentHTML().search('<div class="picsClickAble">')?$("#pageOptionItemPics").removeClass("selected"):$("#pageOptionItemPics").addClass("selected")}function insertPageTitle(){$.ajax({type:"POST",url:"MySQLHandler.php",data:"table=pages_"+lang+"&function=getNameById:"+pageId,success:function(e){var t=getCurrentHTML(),s="<h1>"+e+"</h1>",a=5;if(t.search('<div class="picsClickAble">')>-1)if(t.search("<h1>")>-1)if(t.search("<h1>")<t.search('<div class="picsClickAble">')&&(togglePicsClickable(),togglePicsClickable(),t=getCurrentHTML()),a+=30,t.search("<h1>")<a){var n=t.substr(t.search("</h1>")+5);setEditorHTML('<div class="picsClickAble">'+s+n)}else setEditorHTML(s+t);else t.search('<div class="picsClickAble">')<a?(t=t.substr(t.search('<div class="picsClickAble">')),setEditorHTML('<div class="picsClickAble">'+s+t.substr(t.search(">")+1))):setEditorHTML(s+t);else if(t.search("<h1>")<a&&t.search("<h1>")>-1){var n=t.substr(t.search("</h1>")+a);setEditorHTML(s+n)}else setEditorHTML(s+t)}})}function deleteUserNow(){var e=document.deleteUserForm.name.value;$.ajax({type:"POST",url:"MySQLHandler.php",data:"table=users&function=deleteUser:"+e,success:function(e){"1"==e?$.ajax({type:"POST",url:"users.php",data:"table=users",success:function(e){$(".userControlInner").html(e)}}):$(".userControlInner").html(e),hideMessages()}})}function deleteUser(e){document.deleteUserForm.name.value=e,$(".deleteUserMsg").removeClass("hidden"),$(".overlay").removeClass("hidden"),positionMessage()}function showSetRights(e,t){var s=document.setUserRightsForm;s.name.value=e,s.chk1.checked=!1,s.chk2.checked=!1,s.chk3.checked=!1,s.chk4.checked=!1,"1"==t.substr(0,1)&&(s.chk1.checked=!0),"1"==t.substr(1,1)&&(s.chk2.checked=!0),"1"==t.substr(2,1)&&(s.chk3.checked=!0),"1"==t.substr(3,1)&&(s.chk4.checked=!0),$(".setUserRightsTitle").html(e),$(".setUserRightsMsg").removeClass("hidden"),$(".overlay").removeClass("hidden"),positionMessage()}function setUserRightsNow(){var e=document.setUserRightsForm,t=e.name.value,s=e.chk1.checked?"1":"0";s+=e.chk2.checked?"1":"0",s+=e.chk3.checked?"1":"0",s+=e.chk4.checked?"1":"0",$.ajax({type:"POST",url:"MySQLHandler.php",data:"table=users&function=changeUserRights:"+t+":"+s,success:function(e){"1"==e?$.ajax({type:"POST",url:"users.php",data:"table=users",success:function(e){$(".userControlInner").html(e)}}):$(".userControlInner").html(e),hideMessages()}})}function showUserControl(){$(".userControlOuter").toggleClass("out"),$.ajax({type:"POST",url:"users.php",data:"table=users",success:function(e){$(".userControlInner").html(e)}})}function showPlugins(){$(".pluginOuter").toggleClass("out"),$(".pageMenuItem").removeClass("active"),$(".pageOptions").addClass("hidden").addClass("height0"),resetAllPlugins(),$(".pluginInner").html("Click on an Icon to see the Plugin")}function showInsertLink(){$(".insertLink").html('<lable>choose link type: <select onchange="changeInsertLinkType(this)"><option selected>Text link</option><option>Link to a gallery</option></select></lable><br/><div class="insertLinkInner"></div>'),$(".overlay").removeClass("opac0 hidden"),$(".insertLinkOuter").removeClass("hidden").css("left",$(".leftBar").width()+115),showInsertLinkToPage()}function showAddPictureLink(){$(".insertPicLink").removeClass("opac0 hidden"),$.ajax({type:"POST",url:"functions.php",data:"text=clickAbleMenu:addLinkToPicture($pid,this):"+lang,success:function(e){$(".insertPicLinkMenue").html(e)}})}function addLinkToPicture(e){var t=$("#htmlToInsert").html(),s=document.getElementById("linkTextToInsert").value,a="";t.search("<a ")>-1?(a=t.substr(0,t.search("href")+6),a+="index.php?id="+e+"&lang="+lang+t.substr(t.search(" title")-1),$("#htmlToInsert").html(a),t=a,a=t.substr(0,t.search(" title")+8),a+=s+t.substr(t.search(">")-1),$("#htmlToInsert").html(a),showNotification("Link replaced",1500)):($("#htmlToInsert").html("<a href='index.php?id="+e+"&lang="+lang+"' title='"+s+"'>"+t+"</a>"),showNotification("Link added",1500))}function removeLinkFromPicture(){var e=$("#htmlToInsert").html();e.search("</a>")>-1&&(e=e.substr(e.search(">")+1),$("#htmlToInsert").html(e.replace("</a>","")),showNotification("Link removed",1500))}function changeInsertLinkType(e){switch(e.selectedIndex){case 0:showInsertLinkToPage();break;case 1:showInsertLinkToGallery()}}function showInsertLinkToPage(){$.ajax({type:"POST",url:"functions.php",data:"text=clickAbleMenu:insertLinkToPage($pid,this):"+lang,success:function(e){$(".insertLinkInner").html("Insert a text link to page"+e)}})}function insertLinkToPage(e,t){insertHTMLatCursor('<a href="index.php?id='+e+"&lang="+lang+'">'+t.innerHTML+"</a>"),$(".pageOptions").addClass("height0").addClass("hidden"),$(".pageMenuItem").removeClass("active"),hideInsertLink()}function showInsertLinkToGallery(){$.ajax({type:"POST",url:"functions.php",data:"text=clickAbleMenu:insertLinkToGallery($pid,this):"+lang,success:function(e){$(".insertLinkInner").html("choose page with gallery"+e)}})}function insertLinkToGallery(e,t){var s=$(".galleryPrevSliderOuter").length;$.ajax({type:"POST",url:"functions.php",data:"text=gallerySlider:"+e+":"+t.innerHTML+":"+s+":"+lang,success:function(e){"-1"==e?alert("you have to publish this page first!"):"0"==e?alert("this page does not contain an gallery!"):(insertHTMLatCursor(e),hideInsertLink())}})}function hideInsertLink(){$(".insertLinkOuter").addClass("hidden"),$(".overlay").addClass("hidden")}function showPublish(){$(".publishOuter").removeClass("hidden"),$(".overlay").removeClass("hidden"),positionMessage()}function getSize(){"number"==typeof window.innerWidth?(windowWidth=window.innerWidth,windowHeight=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(windowWidth=document.documentElement.clientWidth,windowHeight=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(windowWidth=document.body.clientWidth,windowHeight=document.body.clientHeight)}function hidePageTour(){$(".pageTour").addClass("opac0"),window.setTimeout("$('.pageTour').addClass('hidden')",900),document.getElementById("showTourAgain").checked&&$.ajax({type:"POST",url:"tour.php",data:"",success:function(e){"1"!=e&&alert(e)}}),document.onkeydown=function(){}}function pageTourStep(e){document.onkeydown=function(t){var s=window.event?window.event:t;39==s.keyCode?(pageTourStep(15>e?e+1:1),t.preventDefault()):37==s.keyCode&&(e>0&&pageTourStep(e-1),t.preventDefault())};var t=$(".leftBar").width(),s=$(".fileBrowser").height();switch(e){default:$(".pageTour").removeClass("white"),$(".tourBox").addClass("hidden").width(t-7).height(windowHeight-5).css("left",0).css("top",0),$(".tourText").html('welcome to your tour</br>let me show you the most important functions of this editor<br/>use arrow keys to navigate<br/><div class="tourBut tourExit tourLeft" onclick="hidePageTour()">exit</div><div class="tourBut" onclick="pageTourStep(1)">proceed</div></div>').css("top",10).css("left",.5*windowWidth-155);break;case 1:$(".pageTour").addClass("white"),$(".tourBox").removeClass("hidden").width(t-12).height(windowHeight-5).css("left",0).css("top",0),$(".tourText").html('here we have our website menu<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>').css("top",100).css("left",t+7);break;case 2:$(".tourBox").width(20).height(20).css("left",0).css("top",3),$(".tourText").css("top",5).css("left",30).html('by clicking on this button you can hide the menu<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>');break;case 3:$(".pageOptions").addClass("height0").addClass("hidden"),$(".tourBox").width(windowWidth-t).height(30).css("left",t-8).css("top",0),$(".tourText").css("top",40).css("left",.5*windowWidth).html('here we have the admin page menu<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>');break;case 4:$(".pageOptions").removeClass("height0").removeClass("hidden"),$(".tourBox").width(73).height(28).css("left",t+48).css("top",-1),$(".tourText").css("top",40).css("left",t+115).html('By clicking on options you can show page options like the plugins (e.g. calendar)<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>');break;case 5:$(".pageOptions").addClass("height0").addClass("hidden"),tourStepSave(e,t);break;case 6:$(".tourBox").width(windowWidth-t+2).height(windowHeight-s-35).css("left",t-9).css("top",32),$(".tourText").css("top",windowHeight-s+7).css("left",.5*windowWidth).html('inside this area you can edit the webpages content<br/>press control + s to save or use the button in the top.<br/>Tipp: use control + p to directly publish a page.<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>');break;case 7:$(".tourBox").width(windowWidth-t+2).height(s-2).css("left",t-9).css("top",windowHeight-s-3),$(".tourText").css("top",windowHeight-s-57).css("left",.5*windowWidth).html('down here is the file browser<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>');break;case 8:$(".tourBox").width(20).height(20).css("left",windowWidth-28).css("top",windowHeight-s),$(".tourText").css("top",windowHeight-s-25).css("left",windowWidth-350).html('by clicking on this button you can hide the file browser<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>');break;case 9:$(".tourBox").width(windowWidth-t-115).height(s-32).css("left",t+103).css("top",windowHeight-s+27),$(".tourText").css("top",windowHeight-s-47).css("left",.5*windowWidth).html('in here you will see the avaliable pictures (click on them to get more options)<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>');break;case 10:$(".tourBox").width(101).height(s-32).css("left",t-4).css("top",windowHeight-s+27),$(".tourText").css("top",windowHeight-s-47).css("left",t-105).html('here you can navigate through the folders (may not be needed)<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>');
    break;case 11:$(".tourBox").width(windowWidth-t+2).height(27).css("left",t-9).css("top",windowHeight-s-3),$(".tourText").css("top",windowHeight-s-97).css("left",.5*windowWidth).html('here you have the uploader menu (set the filetype on the left, upload files by clicking on upload or show the gallery editor)<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>');break;case 12:$(".tourBox").width(t-29).height(22).css("left",10).css("top",32),$(".tourText").css("top",10).css("left",t-10).html('over here we have one menuitem<br/>you can change it\'s position via drag & drop<br/>by clicking on the name you can edit the page<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>');break;case 13:$(".tourBox").width(46).height(22).css("left",t-65).css("top",32),$(".tourText").css("top",10).css("left",t-10).html('the eye shows the visibility of the page<br/>by clicking on the arrow you get more options for this item like rename, delete or add sup pages<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>');break;case 14:$(".tourBox").width(67).height(27).css("left",windowWidth-330).css("top",1),$(".tourText").css("top",35).css("left",windowWidth-445).html('If you think that your page is ready, don\'t forget to publish the page so that everybody can see it.<br/><div class="tourBut tourLeft" onclick="pageTourStep('+(e-1)+')">go back</div><div class="tourBut" onclick="pageTourStep('+(e+1)+')">proceed</div></div>');break;case 15:$(".tourBox").width(63).height(27).css("left",windowWidth-255).css("top",1),$(".tourText").css("top",35).css("left",windowWidth-380).html('don\'t forget to logout when finished<br/>you now know the most important features of this editor<br/>have fun with using it<br/><div class="tourBut tourExit tourLeft" onclick="hidePageTour()">exit</div><input type="checkbox" id="showTourAgain"/>don\'t show this anymore<div class="tourBut" onclick="pageTourStep(0)">restart</div></div>')}}var windowHeight,windowWidth,pageIsIniting=!0,showPageTour=!1,mayCancelLogOut=!0,actCKEPos="NULL",refreshFilesOnBackground,notificationBoxMayHide=!1;