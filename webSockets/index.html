<!DOCTYPE html>
<html>
<head>
    <title>Testing Ajax Poling</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>
        var autoPolling = false;
        function init(){
            ajaxPolling('NULL');
        }
        function ajaxPolling(lastTimestamp){
            $.ajax({
                type: 'POST',
                url: 'server.php',
                data: 'timestamp='+lastTimestamp,
                success: function(data) {
                    var ts = data.substr(0,data.search('#'));
                    data = data.substr(data.search('#')+1);
                    if(ts != lastTimestamp){
                        if(data != '#end'){
                            $('.serverData').html(data.substr(0,data.lastIndexOf('#')));
                        }
                    }
                    if(autoPolling){
                        window.setTimeout('ajaxPolling('+ts+')',2000);
                    }
                }
            });
        }
        function setPolling(th){
            autoPolling = th.checked;
            if(autoPolling){
                ajaxPolling('NULL');
            }
        }
    </script>
</head>
<body onload="init()">
<div class="container">
    <div class="serverData"></div>
    <label><input type="checkbox" onchange="setPolling(this)" />automatic updates</label>
</div>
</body>
</html>